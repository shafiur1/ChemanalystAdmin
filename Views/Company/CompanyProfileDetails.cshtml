    @model ChemAnalyst.ViewModel.CustCompanyVM

@{
    ViewBag.Title = "CompanyProfile";
    Layout = "~/Views/Shared/_LayoutUser7.cshtml";

    int i = 0;
}

<style>

     /* Css related to map */
    /* For all zoom buttons */
    .mapael .zoomButton {
        background-color: #fff;
        border: 1px solid #ccc;
        color: #000;
        width: 15px;
        height: 15px;
        line-height: 15px;
        text-align: center;
        border-radius: 3px;
        cursor: pointer;
        position: absolute;
        top: 0;
        font-weight: bold;
        left: 10px;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -o-user-select: none;
        user-select: none;
    }

    /* Reset Zoom button first */
    .mapael .zoomReset {
        top: 50px;
    }

    /* Then Zoom In button */
    .mapael .zoomIn {
        top: 70px;
    }

    /* Then Zoom Out button */
    .mapael .zoomOut {
        top: 90px;
    }

    .mapael .mapTooltip {
        position: absolute;
        background-color: #474c4b;
        moz-opacity: 0.70;
        opacity: 0.70;
        filter: alpha(opacity=80);
        padding: 10px;
        z-index: 1000;
        max-width: 200px;
        display: none;
        color: #fff;
    }
    /* End of css related to map */
</style>
<div class="inner-banner">
    <img src="/images/about-banner.jpg">
    <h1>Company Profile</h1>
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page"><a href="@Url.Action("CompanyProfile", "Company")">All Company Profiles</a></li>
    </ol>
</div>
<div class="page-content">
    <div class="static-page">
        <div class="container">
            <div class="company-profile" style="margin-top: 15px">
                <a href="@Url.Action("CompanyProfile", "Company")" class="previous" style="text-decoration: none;display: inline-block;padding: 8px 16px;  background-color: #d6d6d6; color: black;">« Back</a>
                <br /><br />
                <div class="com-top-3col">
                    <div class="row">

                        <div class="col-md-2 col-lg-2">
                            <div class="ind-map-col">
                                <img src="~/images/@Model.Logo" class="img-responsive">
                            </div>
                        </div>

                        <div class="col-md-10 col-lg-10">
                            <div class="info-text-col">
                                <h4>@Model.Name</h4>
                                <p>@Model.Description</p>

                            </div>
                        </div>

                        <div class="col-md-6 col-lg-6">
                            <br/>
                            <div class="cm-detail-table">
                                <h3>Basic Details</h3>
                                <table class="table-responsive-lg" style="text-justify:auto">
                                    <tbody>
                                        <tr>
                                            <td>Name of the Company</td>
                                            <td><p>@Model.Name</p></td>
                                        </tr>
                                        <tr>
                                            <td>Registration Date</td>
                                            <td><p>@Model.RegDate.ToString()</p></td>
                                        </tr>
                                        <tr>
                                            <td>CIN</td>
                                            <td><p>@Model.CIN</p></td>
                                        </tr>
                                        <tr>
                                            <td>Company Category/SubCategory</td>
                                            <td><p>@Model.Category</p></td>
                                        </tr>
                                        <tr>
                                            <td>Address</td>
                                            <td><p>@Model.Address</p></td>
                                        </tr>
                                        <tr>
                                            <td>Contact Details</td>
                                            <td>
                                                <p>Website:@Model.website</p>
                                                <p><strong>Email:</strong><Span>@Model.EmailId</Span></p>
                                                <p><strong>Fax:</strong><Span>@Model.fax</Span></p>
                                                <p><strong>Phone No:</strong><Span>+@Model.phoneNo</Span></p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Number of Employees</td>
                                            <td><p>@Model.NOE</p></td>
                                        </tr>
                                        <tr>
                                            <td>Managing Director/CEO</td>
                                            <td><p>@Model.CEO</p></td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <table align="right">
                                <tr>
                                    <td><img src="~/images/triangle.png" width="50" height="50" /></td>
                                    <td align="right">Manufacturing Plant</td>
                                    <td></td>
                                    <td><img src="~/images/square.png" width="35" height="35" /></td>
                                    <td>Corporate Office</td>
                                    <td></td>
                                    <td><img src="~/images/circle.png" width="35" height="35" /></td>
                                    <td align="left">Regional Office</td>
                                </tr>
                               
                            </table>
                            <div class="mapContainer">

                                <div class="map"></div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-6">
                            <div class="cm-detail-table cm-detail-table2">
                                @*<h3>Financial</h3>*@
                                <div class="panel-group" id="accordion">
                                    @foreach (var item1 in Model.lstFinacialData)
                                    {

                                        <div class="panel panel-default" style="margin-bottom: 5px;">
                                            <div class="panel-heading">
                                                <h3 data-toggle="collapse" data-parent="#accordion" href="#collapse1_@item1.FinacialYear" style="cursor:pointer">
                                                    Financial @item1.FinacialYear
                                                </h3>
                                            </div>

                                            @{if (i == 0)
                                                {
                                                    <div id="collapse1_@item1.FinacialYear" class="panel-collapse">
                                                        <div class="panel-body">
                                                            <table class="table table-bordered">
                                                                <tbody>
                                                                    @foreach (var item in Model.lstFinacialData.Where(w => w.FinacialYear == item1.FinacialYear))
                                                                    {
                                                                        <tr>
                                                                            <td>Revenue (INR Million)</td>
                                                                            <td>@item.Revenue</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>Y-o-Y Revenue Growth</td>
                                                                            <td>@item.Growth %</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>PBT (INR Million)</td>
                                                                            <td>@item.PBT</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>PBT Margin</td>
                                                                            <td>@item.Margin %</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>PAT (INR Million)</td>
                                                                            <td>@item.Pat</td>
                                                                        </tr>


                                                                        <tr>
                                                                            <td>PAT Margin</td>
                                                                            <td>@item.Margin1 %</td>
                                                                        </tr>


                                                                    }
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                }

                                                else
                                                {
                                                    <div id="collapse1_@item1.FinacialYear" class="panel-collapse collapse in">
                                                        <div class="panel-body">
                                                            <table class="table table-bordered">
                                                                <tbody>
                                                                    @foreach (var item in Model.lstFinacialData.Where(w => w.FinacialYear == item1.FinacialYear))
                                                                    {
                                                                        <tr>
                                                                            <td>Revenue (INR Million)</td>
                                                                            <td>@item.Revenue</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>Y-o-Y Revenue Growth</td>
                                                                            <td>@item.Growth %</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>PBT (INR Million)</td>
                                                                            <td>@item.PBT</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>PBT Margin</td>
                                                                            <td>@item.Margin %</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>PAT (INR Million)</td>
                                                                            <td>@item.Pat</td>
                                                                        </tr>


                                                                        <tr>
                                                                            <td>PAT Margin</td>
                                                                            <td>@item.Margin1 %</td>
                                                                        </tr>

                                                                    }
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                }
                                            }


                                        </div>
                                        i++;
                                    }
                                </div>


                                @*<table class="table table-bordered">
                    <tbody>
                        @foreach (var item in Model.lstFinacialData)
                        {
                            <tr>
                                <td>Revenue - @item.FinacialYear</td>
                                <td>@item.Revenue INR</td>
                            </tr>
                                <tr>
                                    <td>% Growth - @item.FinacialYear</td>
                                    <td>@item.Growth %</td>
                                </tr>
                                <tr>
                                    <td>PBT - @item.FinacialYear</td>
                                    <td>@item.PBT</td>
                                </tr>
                                <tr>
                                    <td>Pat - @item.FinacialYear</td>
                                    <td>@item.Pat</td>
                                </tr>
                                <tr>
                                    <td>Margin - @item.FinacialYear</td>
                                    <td>@item.Margin</td>
                                </tr>

                                <tr>
                                    <td>Margin1 - @item.FinacialYear</td>
                                    <td>@item.Margin1</td>
                                </tr>

                                <tr>
                                    <td>Liablities - @item.FinacialYear</td>
                                    <td>@item.Liablities</td>
                                </tr>
                        }
                    </tbody>
                </table>*@
                            </div>
                        </div>
                        <div class="col-md-6">
                            
                        </div>

                        <div class="col-md-12" style="    margin-bottom: 20px;">
                            <div class="mains-indus-tabs">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item">




                                        <a class="nav-link active" data-toggle="tab" href="#home">Strengths</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#menu1">Weaknesses</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#menu2">Opportunities</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#menu3">Threats</a>
                                    </li>
                                </ul>
                                <!-- Tab panes -->
                                @if (ViewBag.S != null)
                                {
                                    <div class="tab-content">
                                        <div id="home" class="container tab-pane active">
                                            <br /><p>@Html.Raw(ViewBag.S.Strength)</p>
                                        </div>
                                        <div id="menu1" class="container tab-pane fade">
                                            <br /><p>@Html.Raw(ViewBag.S.Weakness)</p>
                                        </div>
                                        <div id="menu2" class="container tab-pane fade">
                                            <br /><p>@Html.Raw(ViewBag.S.Opportunity)</p>
                                        </div>
                                        <div id="menu3" class="container tab-pane fade">
                                            <br /><p>@Html.Raw(ViewBag.S.Threat)</p>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="tab-content">
                                        <div id="home" class="container tab-pane active">
                                            <br /><p></p>
                                        </div>
                                        <div id="menu1" class="container tab-pane fade">
                                            <br /><p></p>
                                        </div>
                                        <div id="menu2" class="container tab-pane fade">
                                            <br /><p></p>
                                        </div>
                                        <div id="menu3" class="container tab-pane fade">
                                            <br /><p></p>
                                        </div>
                                    </div>
                                }
                            </div>

                        </div>

                        <div class="col-md-6">

                            <div class="mains-indus-tabs">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item">

                                        <a class="nav-link active" data-toggle="tab" href="#pp">Company Expansion Plans</a>
                                    </li>


                                </ul>
                                <!-- Tab panes -->

                                <div class="tab-content">
                                    <div id="pp" class="container tab-pane active">
                                        <br /><p>

                                            @if (ViewBag.S != null)
                                            {
                                                @Html.Raw(ViewBag.S.CompanyExpansionBlock)
                                            }

                                        </p>
                                    </div>


                                </div>

                            </div>

                        </div>
                        <div class="col-md-6">

                            <div class="mains-indus-tabs">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item">

                                        <a class="nav-link active" data-toggle="tab" href="#pp1">Perspectives</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#ss">Strategies</a>
                                    </li>

                                </ul>
                                <!-- Tab panes -->
                                @if (ViewBag.S != null)
                                {
                                    <div class="tab-content">
                                        <div id="pp1" class="container tab-pane active">
                                            <br /><p>@Html.Raw(ViewBag.S.Perspective)</p>
                                        </div>
                                        <div id="ss" class="container tab-pane fade">
                                            <br /><p>@Html.Raw(ViewBag.S.Strategy)</p>
                                        </div>

                                    </div>
                                }
                                else
                                {
                                    <div class="tab-content">
                                        <div id="pp1" class="container tab-pane active">
                                            <br /><p></p>
                                        </div>
                                        <div id="ss" class="container tab-pane fade">
                                            <br /><p></p>
                                        </div>

                                    </div>
                                }
                            </div>
                        </div>


                    </div>
                </div>

            </div>

        </div>
    </div>
</div>

<script src="~/js/jquery.js"></script>
<script src="~/js/jquery-3.3.1.slim.min.js"></script>
<script src="~/js/popper.min.js"></script>
<script src="~/js/bootstrap.min.js"></script>
@*<script src="http://cdnjs.cloudflare.com/ajax/libs/simplelightbox/1.17.1/simple-lightbox.js"></script>*@
<script src="~/js/owl.carousel.js"></script>
<script src="~/js/wow.min.js"></script>
<script src="~/js/honey-custom.js"></script>

<script>
        var companyId = @Model.id;
        var mapDataUrl = "@Url.Action("GetVisitorMapData", "Company")";
</script>

<!--Scripts for map-->
<script src="~/js/raphael.min.js"></script>
<script src="~/js/mapael.js"></script>
<script src="~/js/india_states.js"></script>
<script src="~/js/india_states_legends.js"></script>

<script type="text/javascript">
    var image = ["square", "circle", "triangle"];
    var plots = [];

    function productSelected() {
        CallAjax(mapDataUrl, "{ companyId:" + companyId + "}", function (response) {
            if (response) {
                response = JSON.parse(response);
                if (response != undefined && response != null && response.length > 0) {
                    var plots = GeneratePlots(response);
                    InitializeMap(plots);
                } else {
                    InitializeMap();
                }
            } else {
                InitializeMap();
            }
        });
    }

    function InitializeMap(plots) {
        var options = {
            map: {
                zoom: {
                    enabled: true,
                    maxLevel: 10
                },
                name: "india_states",
                defaultArea: {
                    attrs: {
                        fill: "#f5f7f3"
                    }
                }
            }
        };
        if (plots) {
            options["plots"] = plots;
        }
        $(".mapContainer").mapael(options);
    }
    //Call map
    productSelected();

    function GeneratePlots(data) {
        var newPlots = {};
        var locations = data.map(item => item.Location).filter((value, index, self) => self.indexOf(value) === index);
        locations.map(function (l, i) {
            var tempData = data.filter(function (p) { return p.Location == l });
            var types = tempData.map(item => item.Type).filter((value, index, self) => self.indexOf(value) === index);
            types.map(function (t) {
                var typeTempData = tempData.filter(function (tp) { return tp.Type == t });
                var type = t == 'Corp Office' ? 0 : (t == 'Regional Office' ? 1 : (t == 'Plant' ? 2 : 0));
                var coords = legends[l][type].split(',');
                var toolTipContent = "";
                typeTempData.map(function (ttd) {
                    if (t == "Plant") {
                        toolTipContent += ttd.City + ":" + ttd.Capacity + " <br />";
                    } else {
                        toolTipContent += ttd.City + " <br />";
                    }
                });
                coords[0] = parseFloat(coords[0]);
                coords[1] = parseFloat(coords[1]);
                newPlots["plot_" + i.toString() + type.toString()] = {
                    type: "image",
                    url: 'http://chemanalyst.com/images/' + image[type] + ".png",
                    x: coords[0],
                    y: coords[1],
                    height: 64,
                    width: 64,
                    
                    tooltip: { content: toolTipContent },
                    attrsHover: {
                        transform: "s1.5",
                        opacity: 1
                    }
                }
            });
        });
        return newPlots;
    }
    function CallAjax(url, params, callback) {
        const http = new XMLHttpRequest();
        http.open('POST', url);
        http.setRequestHeader('Content-type', 'application/json');
        http.send(params) // Make sure to stringify
        http.onload = function () {
            // Do whatever with response
            callback(http.response, http);
        }
    }
</script>